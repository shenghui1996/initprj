$(function(){$("#site-search").blur(function(){$("#searchbox").animate({width:"0",}).hide();$("#searchcontrol").show();$("#toolsbar").show()});var b={ifItsmall:function(){if($(window).width()>752&&$(window).width()<976){$("#formhide").on("click",function(){$("#searchbox").show().animate({width:"113px"},300);$("#site-search").focus();$("#searchcontrol").hide();$("#toolsbar").hide()})}else{$("#toolsbar").show();$("#formhide").off("click").on("click",function(){$("#searchbox").show().animate({width:"113px"});$("#site-search").focus();$("#searchcontrol").hide()})}}};b.ifItsmall();$(window).resize(function(){b.ifItsmall()});function a(){if(window.location.href.indexOf(global_contextPath+"/ppt/")>-1){return false}if(gbin1_userid!=0){var c={isread:0};identityService.findAllUnReadActivities(c,{callback:function(d){if(d.length>0){$("#mymsg").html(d.length).removeClass("hidden").closest(".dropdown-menu").prev().children().addClass("warning-text animated flash")}else{$("#mymsg").html("").addClass("hidden")}}})}window.setTimeout("getactivitymsg()",120000)}$(function(){if(global_onlineuser.uid>0){setTimeout(function(){getprivatemsg()},2000);if(document.URL.indexOf("notification")<0){setTimeout(function(){a()},4000)}}})});$(function(){$("#gbtagsNameLabel").addClass("selected");var i=null,d=$("<button/>",{id:"confirmcancel",text:"取消",style:"text-align:center;"}),h=false,g=$("#resultsDiv"),f=$("#more"),l=$("#newtags"),j=$('<div class="loading"></div>'),c=$("#submitButton"),e={},m={},b={siteURL:"gbtags.com",searchTag:false,searchGBTags:true,type:"web",append:false,perPage:10,page:0,},k={searchWhiceOne:function(){if(b.searchTag){$("#tagNameLabel").siblings().css("color","#AAA").end().css("color","#4caf50");gbtagSearch();$("#resultnum").hide()}else{$("#gbtagsNameLabel").siblings().css("color","#AAA").end().css("color","#4caf50");a();$("#resultnum").show()}}};if(typeof search!="undefined"&&search!==""){$("#s").val(search);k.searchWhiceOne()}identityService.findAllTags({callback:function(o){var n=[];$.each(o,function(p,q){n.push(q.tagname)});$("#s").typeahead({local:n}).each(function(){$(this).prev(".tt-hint").addClass("hidden")})}});function a(o){o=$.extend({},b,o);o.term=o.term||$("#s").val();if(h){g.html("").append(j)}c.attr("disabled","disabled");if(o.term===""){o.term="*"}var p=($(".webResult").length/o.perPage)*o.perPage;var n=encodeURIComponent(o.term);$.getJSON("/gbsearch/gbtags/select?q=title:"+n+"&start="+p+"&hl=true&hl.fl=title&hl.simple.pre=<em>&hl.simple.post=</em>&wt=json&indent=false",function(t){$("#numfound").html(t.response.numFound);f.show();if($(".webResult").length<=t.response.numFound){var A=Handlebars.compile($("#gbtags-data-tmpl").html());var s=t.highlighting,r=t.response.docs,B=[];for(var u=0;u<r.length;u++){var q=r[u].id,y=r[u].title,z=r[u].description,w=r[u].resourcename;t.rnum=w;for(var v in s){if(v===q){if(s[v].title!==undefined){y=s[v].title}break}}B.push({title:y,id:q,description:z})}var x=A(B);$("#resultsDiv").append(x);$("<div>",{id:"more"}).appendTo(g).click(function(){h=false;a({append:true,page:o.page+1});$(this).hide()});o.page++}else{f.hide();$("#resultsDiv").append('<div style="text-align:center;">没有更多相关搜索结果</div>')}$("#submitButton").removeAttr("disabled");j.remove()})}$("#resultsDiv").on("click","#confirmcancel",function(){clearTimeout(canceltimetout);$("#autosearchwrapper").hide();d.hide()});$("#searchForm").submit(function(n){h=true;e.page=0;k.searchWhiceOne();if($(".no-more")!=null||$(".no-more")!=undefined){$(".no-more").remove()}n.preventDefault();return false});f.click(function(){h=false;a({append:true})})});