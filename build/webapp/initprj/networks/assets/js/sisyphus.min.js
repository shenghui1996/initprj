(function(b){b.sisyphus=function(){return Sisyphus.getInstance()};b.fn.sisyphus=function(d){var c=Sisyphus.getInstance();c.setOptions(d);c.protect(this);return c};var a={};a.isAvailable=function(){if(typeof b.jStorage==="object"){return true}try{return localStorage.getItem}catch(c){return false}};a.set=function(c,d){if(typeof b.jStorage==="object"){b.jStorage.set(c,d+"")}else{try{localStorage.setItem(c,d+"")}catch(f){}}};a.get=function(d){if(typeof b.jStorage==="object"){var c=b.jStorage.get(d);return c?c.toString():c}else{return localStorage.getItem(d)}};a.remove=function(c){if(typeof b.jStorage==="object"){b.jStorage.deleteKey(c)}else{localStorage.removeItem(c)}};Sisyphus=(function(){var d={instantiated:null,started:null};function c(){return{setInitialOptions:function(e){var f={excludeFields:[],customKeyPrefix:"",timeout:0,autoRelease:true,name:null,onSave:function(){},onBeforeRestore:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||b.extend(f,e);this.browserStorage=a},setOptions:function(e){this.options=this.options||this.setInitialOptions(e);this.options=b.extend(this.options,e)},protect:function(e){e=e||{};var f=this;this.targets=this.targets||[];this.href=this.options.name||location.hostname+location.pathname+location.search+location.hash;this.targets=b.merge(this.targets,e);this.targets=b.unique(this.targets);this.targets=b(this.targets);if(!this.browserStorage.isAvailable()){return false}f.restoreAllData();if(this.options.autoRelease){f.bindReleaseData()}if(!d.started){f.bindSaveData();d.started=true}},bindSaveData:function(){var e=this;if(e.options.timeout){e.saveDataByTimeout()}e.targets.each(function(){var g=b(this).attr("id");var f=b(this).find(":input").not(":submit").not(":reset").not(":button").not(":file");f.each(function(){if(b.inArray(this,e.options.excludeFields)!==-1){return true}var i=b(this);var h=e.href+g+i.attr("name")+e.options.customKeyPrefix;if(i.is(":text")||i.is("textarea")){if(!e.options.timeout){e.bindSaveDataImmediately(i,h)}}else{e.bindSaveDataOnChange(i,h)}})})},saveAllData:function(){var e=this;e.targets.each(function(){var g=b(this).attr("id");var f=b(this).find(":input").not(":submit").not(":reset").not(":button").not(":file");f.each(function(){var j=b(this);if(b.inArray(this,e.options.excludeFields)!==-1||j.attr("name")===undefined){return true}var i=e.href+g+j.attr("name")+e.options.customKeyPrefix;var h=j.val();if(j.is(":checkbox")){if(j.attr("name").indexOf("[")!==-1){h=[];b("[name='"+j.attr("name")+"']:checked").each(function(){h.push(b(this).val())})}else{h=j.is(":checked")}e.saveToBrowserStorage(i,h,false)}else{if(j.is(":radio")){if(j.is(":checked")){h=j.val();e.saveToBrowserStorage(i,h,false)}}else{e.saveToBrowserStorage(i,h,false)}}})});if(b.isFunction(e.options.onSave)){e.options.onSave.call()}},restoreAllData:function(){var e=this;var f=false;if(b.isFunction(e.options.onBeforeRestore)){e.options.onBeforeRestore.call(e)}e.targets.each(function(){var h=b(this);var i=h.attr("id");var g=h.find(":input").not(":submit").not(":reset").not(":button").not(":file");g.each(function(){if(b.inArray(this,e.options.excludeFields)!==-1){return true}var l=b(this);var k=e.href+i+l.attr("name")+e.options.customKeyPrefix;var j=e.browserStorage.get(k);if(j){e.restoreFieldsData(l,j);f=true}})});if(f&&b.isFunction(e.options.onRestore)){e.options.onRestore.call()}},restoreFieldsData:function(f,e){if(f.attr("name")===undefined){return false}if(f.is(":checkbox")&&e!=="false"&&f.attr("name").indexOf("[")===-1){f.attr("checked","checked")}else{if(f.is(":checkbox")&&e==="false"&&f.attr("name").indexOf("[")===-1){f.removeAttr("checked")}else{if(f.is(":radio")){if(f.val()===e){f.attr("checked","checked")}}else{if(f.attr("name").indexOf("[")===-1){f.val(e)}else{e=e.split(",");f.val(e)}}}}},bindSaveDataImmediately:function(g,f){var e=this;if(typeof b.browser.msie==="undefined"){g.get(0).oninput=function(){e.saveToBrowserStorage(f,g.val())}}else{g.get(0).onpropertychange=function(){e.saveToBrowserStorage(f,g.val())}}},saveToBrowserStorage:function(f,g,e){e=e===null?true:e;this.browserStorage.set(f,g);if(e&&g!==""&&b.isFunction(this.options.onSave)){this.options.onSave.call()}},bindSaveDataOnChange:function(g,f){var e=this;g.change(function(){e.saveAllData()})},saveDataByTimeout:function(){var f=this;var e=f.targets;setTimeout((function(g){function h(){f.saveAllData();setTimeout(h,f.options.timeout*1000)}return h})(e),f.options.timeout*1000)},bindReleaseData:function(){var e=this;e.targets.each(function(g){var h=b(this);var f=h.find(":input").not(":submit").not(":reset").not(":button").not(":file");var j=h.attr("id");b(this).bind("submit reset",function(){e.releaseData(j,f)})})},manuallyReleaseData:function(){var e=this;e.targets.each(function(g){var h=b(this);var f=h.find(":input").not(":submit").not(":reset").not(":button").not(":file");var j=h.attr("id");e.releaseData(j,f)})},releaseData:function(h,e){var g=false;var f=this;e.each(function(){if(b.inArray(this,f.options.excludeFields)!==-1){return true}var j=b(this);var i=f.href+h+j.attr("name")+f.options.customKeyPrefix;f.browserStorage.remove(i);g=true});if(g&&b.isFunction(f.options.onRelease)){f.options.onRelease.call()}}}}return{getInstance:function(){if(!d.instantiated){d.instantiated=c();d.instantiated.setInitialOptions()}return d.instantiated},free:function(){d={};return null}}})()})(jQuery);